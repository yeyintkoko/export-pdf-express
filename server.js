//console.log(process.env)

var express = require('express');
var bodyParser = require('body-parser')

var app = express();

var jsreport = require('jsreport');

// parse application/x-www-form-urlencoded
app.use(bodyParser.urlencoded({ extended: false }))

// parse application/json
app.use(bodyParser.json())

// app.get('/', function (req, res){
//   res.sendFile(__dirname + '/'+ 'fetch.html')
// })


function toUpperCase(str) {
    return str.toUpperCase();
}

app.get('/', function (req, res){
  jsreport.render({
    template: {
       content:
       `<h1>{{title}}</h1>
        {{#if shouldPring}}
          <h3>{{name}}</h3>
        {{/if}}
        {{#each comments}}
          <h2>{{title}}</h2>
          <div>{{body}}</div>
        {{/each}}        
        <img src='data:image/png;base64,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' />
       `,
       engine: 'handlebars',
       recipe: 'phantom-pdf'
    },
    data: {
      title: 'Hello world',
      shouldPrint : true,
      name : 'Jan Blaha',
      comments: [ {"title": "New job", "body": "js developers wanted at... " }]
    },
  }).then(function(out) {
    out.stream.pipe(res);
  }).catch(function(e) {
    res.end(e.message);
  });
})



var server = app.listen(8085, function () {

  var host = server.address().address
  var port = server.address().port

  console.log("Example app listening at http://%s:%s", host, port)

})
